<div class="component-container" *ngIf="user; else loading">
    <form #profileEditForm="ngForm" name="form" (ngSubmit)="onSubmit()">
        <div id="profile">
            <h1 style="display: flex; margin-bottom: 0px">
                <mat-icon style="align-self: center; margin-right: 10px">portrait</mat-icon>
                <mat-form-field class="form-group" appearance="fill">
                    <mat-label for="username">Username</mat-label>
                    <input
                        matInput
                        type="text"
                        name="username"
                        id="username"
                        class="form-control"
                        [(ngModel)]="user.username"
                        #username="ngModel"
                        minlength="1"
                        required
                        [ngClass]="{
                            'is-invalid': username.invalid && username.touched
                        }"
                    />
                    <mat-error *ngIf="username.invalid && username.touched" class="invalid-feedback">
                        <mat-error *ngIf="username.errors!['required']">Username is required</mat-error>
                        <mat-error *ngIf="username.errors!['minlength']"
                            >Username must be at least 1 character long.</mat-error
                        >
                    </mat-error>
                </mat-form-field>
            </h1>
            <div class="text-muted">
                <p>
                    <i>
                        Member since:
                        {{ user.createdAt | date : 'dd/MM/yyyy' }}
                    </i>
                </p>
            </div>

            <mat-form-field class="form-group" appearance="fill">
                <mat-label for="profileDescription">Profile description</mat-label>
                <textarea
                    matInput
                    name="profileDescription"
                    type="text"
                    id="profileDescription"
                    [(ngModel)]="user.profileDescription"
                    #description="ngModel"
                ></textarea>
            </mat-form-field>
            <div>
                <mat-form-field class="form-group" appearance="fill">
                    <mat-label for="latitude">Latitude</mat-label>
                    <input
                        matInput
                        type="number"
                        name="latitude"
                        [(ngModel)]="user.location!.coordinates!.latitude"
                        #latitude="ngModel"
                        min="-90"
                        max="90"
                        [ngClass]="{
                            'is-invalid': latitude.invalid && latitude.touched
                        }"
                    />
                    <mat-error *ngIf="latitude.invalid && latitude.touched" class="invalid-feedback">
                        <mat-error *ngIf="latitude.errors!['min'] || latitude.errors!['max']"
                            >Latitude must be between -90 and 90.</mat-error
                        >
                    </mat-error>
                </mat-form-field>
                <mat-form-field class="form-group" appearance="fill">
                    <mat-label for="longitude">Longitude</mat-label>
                    <input
                        matInput
                        type="number"
                        name="longitude"
                        [(ngModel)]="user.location!.coordinates!.longitude"
                        #longitude="ngModel"
                        min="-90"
                        max="90"
                        [ngClass]="{
                            'is-invalid': longitude.invalid && longitude.touched
                        }"
                    />
                    <mat-error *ngIf="longitude.invalid && longitude.touched" class="invalid-feedback">
                        <mat-error *ngIf="longitude.errors!['min'] || longitude.errors!['max']"
                            >Longitude must be between -180 and 180.</mat-error
                        >
                    </mat-error>
                </mat-form-field>
                <button mat-flat-button style="min-height: 56px" (click)="getLocation()">
                    Use your device's location
                </button>
            </div>
        </div>
        <div class="buttons">
            <div class="">
                <button mat-flat-button class="btn btn-warning" routerLink="..">Cancel</button>
                <button
                    mat-flat-button
                    color="primary"
                    type="submit"
                    class="btn btn-primary"
                    [disabled]="!profileEditForm.valid"
                >
                    Submit
                </button>
            </div>
        </div>
    </form>
</div>

<ng-template #loading><mat-progress-bar value="indeterminate"></mat-progress-bar></ng-template>
